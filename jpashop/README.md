API 개발 기본
--------------

- 커맨드와 쿼리를 분리하라. 
  - ``Member update(Long id, String name)``
  - 위 함수는 커맨드와 조회가 함께 되고 있음.
  - ``void update(Long id, String name)``
  - 위 함수는 커맨드만 수행함. (조회를 하고 싶다면, 다시 select를 호출하라.)

API 개발 고급
--------------
- Entity를 외부에 노출하지 말라.
  - API 스펙이 Entity에 의존적으로 변하는 문제
  - 양방향 관계에서의 무한 루프
  - Lazy 로딩이 설정된 경우, Jackson 라이브러리가 Proxy 객체를 reflect하지 못함.
  - > 외부 노출용 DTO를 사용하라.

- 지연 로딩에 의한 성능 이슈
  - N + 1 문제
    - 1번째 쿼리의 결과가 N개이고 결과 타입에 지연 로딩 연관관계가 M개일 경우, 최대 1 + N * M 개의 쿼리가 실행됨
      - order 조회 1번
      - order -> member 지연 로딩 조회 
      - order -> delivery 지연 로딩 조회
      - order의 결과가 2개일 경우, 1 + 2 * 2 개의 쿼리 실행(모두 영속성 컨텍스트에 존재하지 않을 때)

- 페치 조인
  - 지연 로딩을 무시하고 연관 관계 Entity를 1번의 쿼리로 가져올 수 있다. 
    - 지연 로딩 연관 관계에 의한 N개의 쿼리 이슈가 발생하지 않음.
    - 적극 활용!

- 쿼리 방식 선택 권장 순서
  - 우선 엔티티를 DTO로 변환하는 방법을 선택한다. 
  - 필요하면 페치 조인으로 성능을 최적화 한다. 대부분의 성능 이슈가 해결된다. 
  - 그래도 안되면 DTO로 직접 조회하는 방법을 사용한다. 
  - 최후의 방법은 JPA가 제공하는 네이티브 SQL이나 스프링 JDBC Template을 사용해서 SQL을 직접 사용한다.